<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>tinder | Hẹn hò, kết bạn</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <!-- <link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        #photo-block {
            display: flex;
            width: 100%;
            justify-content: space-between;
            flex-wrap: wrap;
            padding: 10px;
        }
    </style>


    <!-- <link rel="stylesheet" href="styles.css"> -->
</head>

<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/CSSPlugin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/easing/EasePack.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenLite.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.15.0/utils/Draggable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>  -->
<link href="/assets/profile/profile.css" rel="stylesheet"><!--
<link href='https://fonts.googleapis.com/css?family=Noto+Sans' rel='stylesheet' type='text/css'> -->
<div class="container-flug">
    <div class="side-bar">
        <div class="top-side-bar d-flex justify-content-between align-items-center">
            <div class="block-avatar d-flex justify-content-between align-items-center">
                <img class="avatar me-2" th:src="${user.getPhotos().get(0).getImageUrl()}">
                <label class="name-acount" th:text="${userprofile.fullName}" style="font-size: 20px"></label>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <div class="acount-action"><i class="fa-solid fa-magnifying-glass"></i></div>
                <div class="acount-action"><i class="fa-solid fa-suitcase"></i></div>
                <div class="acount-action"><i class="fa-solid fa-shield-heart"></i></div>
            </div>
        </div>

        <div class="massage" style="background-color: #121418; height: 100%;">
            <!--            <div class="tab-massage " style="flex-direction: columns; display:  flex;">-->
            <!--                <div class="tab col-6">-->
            <!--                    <button class="tab-button active" data-tab="tab1" style="width: 200px;">Các tương hợp</button>-->
            <!--                </div>-->
            <!--                <div class="tab col-6">-->
            <!--                    <button class="tab-button" data-tab="tab2" style="width: 200px;">Tin nhắn</button>-->
            <!--                </div>-->
        </div>
        <div class="tab-content" style="display: block;">
            <div id="tab1" class="tab-pane active">
                <img class="active-img"
                     src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS6UPcrppJK4m1q4wu6KgJMAKP63NXrj_dXLA&usqp=CAU"
                     alt="">
            </div>
            <div id="tab2" class="tab-pane" style="color: white;">
                <i class="active-massage fa-solid fa-comment fa-flip-horizontal fa-2xl"></i>
            </div>
        </div>
    </div>
</div>
<div class="wrapper" id="wrapper">
    <div class="scrollbar" id="style-defau  lt">
        <div class="force-overflow"></div>
        <img th:src="${user.getPhotos().get(0).getImageUrl()}" alt="" class="user-img">
        <div class="info-user">
            <H1 th:text="${userprofile.fullName}"></H1>
            <p><i class="fa-solid fa-house"></i> sống ở huế</p>
            <p th:text="${userprofile.getGender()}"><i class="fa-regular fa-user"></i></p>
            <p th:text="${userprofile.getEmail()}"><i class="fa-regular fa-envelope"></i></p>
            <div style="color: white;" class="interest">
                <H2>Sở thích</H2>

            </div>
        </div>
        <div class="edit-info">
            <button class="btn-edit-info" onclick="showEdit(event)">Sửa thông tin</button>
        </div>
    </div>
</div>
<div class="wrapper2" id="wrapper2" th:object="${user}">
    <form method="post" th:object="${userprofile}" th:action="@{/profile}" role="form" enctype="multipart/form-data"
          id="formSubmit">
        <div class="scrollbar" id="style-default">
            <div class="message-edit">
                <label class="form-label">Chỉnh sửa</label>

            </div>
            <div class="img-all">
                <div  class="d-flex upload-wrapper">
                    <label for="fullName" class="massage-edit2">Ảnh của bạn</label>
                    <div id="photo-block">

                    </div>

<!--                    <div class="text-center">-->
<!--                        <p class="fw-bold">Thêm video, ảnh hoặc loop để hoàn thành thêm 4% hồ sơ của bạn, cùng cơ hội-->
<!--                            nhận được nhiều lượt Thích hơn.</p>-->
<!--                    </div>-->
<!--                    <div class="edit-info2">-->
<!--                        <button class="btn-edit-info2" onclick="showInterests(event)">Thêm Sở Thích</button>-->
<!--                    </div>-->
                    <input type="hidden" name="id" th:value="*{id}">
                    <label for="fullName" class="massage-edit2">Tên</label>
                    <input id="fullName" name="fullName" class="input-edit" th:value="${userprofile.fullName}"/>
                    <label for="email" class="massage-edit2">Email</label>
                    <input id="email" name="email" class="input-edit" th:value="${userprofile.email}"/>
                    <label for="phone" class="massage-edit2">Phone</label>
                    <input id="phone" name="phone" class="input-edit" th:value="${userprofile.phone}"/>
                    <label for="age" class="massage-edit2">Tuổi</label>
                    <input id="age" name="age" class="input-edit" th:value="${userprofile.age}"/>
                    <label class="massage-edit2">Giới tính</label>
                    <div class="d-flex justify-content-between">
                        <div th:each="gender, iterStat : ${genders}">
                            <input type="radio" class="btn-check" th:name="options"
                                   th:id="'option' + ${iterStat.index+1}" autocomplete="off"
                                   th:value="${gender}" th:field="*{gender}"/>
                            <label style="width: 105px" class="btn btn-outline-secondary me-2 radius fw-bold"
                                   th:for="'option' + ${iterStat.index+1}" th:text="${gender}"></label>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div id="interestModal" class="modal">
                    <div class="modal-content">
                        <div class="d-flex justify-content-between">
                            <h3>Chọn sở thích</h3>
                            <button onclick="hideInterests(event)" class="btn-close">
                            </button>
                        </div>
                        <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                            <div class="d-flex">
                                <div th:each="interest, iterStat : ${allInterests}">
                                    <input type="checkbox" class="btn-check check" th:name="interest"
                                           th:id="'btncheck' + ${iterStat.index+1}" autocomplete="off"
                                           th:value="${interest}"
                                           onclick="selectInterest('${interest}')">
                                    <label class="btn btn-outline-secondary me-2 radius fw-bold" style="margin:15px"
                                           th:for="'btncheck' + ${iterStat.index+1}" th:text="${interest}"></label>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button id="interestSubmitBtn" type="button" class="btn btn-primary radius fw-bold"
                                    onclick="saveInterests()" style="padding: 5px 20px;margin: 20px auto">
                                Chọn
                            </button>
                        </div>
                    </div>
                </div>

                <div class="div-mr">
                    <label class="massage-edit2">Sở thích</label><br>
                    <div class="showInterests">
                    </div>
                    <div style="margin-left: 10px">
                        <button onclick="showInterests(event)" class="btn btn-outline-secondary radius fw-bold">
                            <i class="fas fa-plus"></i>
                            Thêm sở thích
                        </button>
                    </div>
                </div>
            </div>
            <div class="text-center" style="margin: 20px">
                <button type="submit" class="btn btn-danger radius fw-bold" onclick="checkSubmit(event)">

                    Sửa thông tin
                </button>
            </div>

        </div>
    </form>
</div>



</body>
<script>

    let interest = [];
    function renderPhoto() {
        $.ajax({
            url: "/api/users/getPhoto",
            method: "GET",
            contentType: "application/json",
            success: function (response) {
                interest = response.interests;
                let matchE = document.getElementById("photo-block");
                let html=``
                let imgSrc = "https://via.placeholder.com/100x150"
                let photo = response.photos;
                    for (let i = 0; i < 6; i++){
                        if (photo && i < photo.length) {
                            imgSrc = photo[i].imageUrl
                        } else {
                            imgSrc = "https://via.placeholder.com/100x150"
                        }
                        html+=`
                                   <div class="image-upload col-6">
                        <label for="file-input-${i + 1}">
                            <img class="preview-image-all" id="preview-image-${i + 1}"
                                 src=${imgSrc} width="100px"
                                 height="120px">
                        </label>
                        <div class="center">
                            <input class="input-upload" id="file-input-${i + 1}" type="file" name="fileUpload" multiple
                                   onchange="document.getElementById('preview-image-${i + 1}').src = window.URL.createObjectURL(this.files[0])">
                        </div>
                    </div>`
                    }
                matchE.innerHTML = html;
            },
            error: function (error) {
                console.log("Đã có lỗi xảy ra: " + error);
            }
        })
    }
    renderPhoto()

    function showEdit(event) {
        // event.preventDefault();
        const editModal = document.getElementById("wrapper2");
        const profileModal = document.getElementById("wrapper")
        editModal.style.display = "flex";
        profileModal.style.display = "none"
    }
    function checkSubmit(event) {
        event.preventDefault();
        // const fileInputs = document.querySelectorAll('input[type="file"]');
        // let imageCount = 0;
        // for (const img of fileInputs) {
        //     if (img.files.length > 0) {
        //         imageCount++
        //     }
        // }
        const checkboxInputs = document.querySelectorAll('input[type="checkbox"]');
        let isChecked = false;
        for (const inter of checkboxInputs) {
            if (inter.checked) {
                isChecked = true;
                break;
            }
        }
        // if (imageCount < 2) {
        //     swal.fire({
        //         icon: 'error',
        //         title: 'Error',
        //         text: 'Please add at least 2 photos to continue',
        //     });
        // }else
            if (!isChecked) {
                    swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Please add at least 1 interest to continue',
                    });
        } else {
            const form = document.getElementById("formSubmit");
            form.submit();
        }
    }

    function showInterests(event) {
        event.preventDefault();
        const interestModal = document.getElementById("interestModal");
        interestModal.style.display = "block";
        let selectedInterests = JSON.parse(sessionStorage.getItem('selectedInterests'));
        let inputs = document.querySelectorAll('#interestModal input[type="checkbox"]');
        for (let i = 0; i < inputs.length; i++) {
            if (interest.indexOf(inputs[i].value) > -1) {
                inputs[i].checked = true;
            }
        }
    }

    function hideInterests() {
        event.preventDefault();
        const interestModal = document.getElementById("interestModal");
        interestModal.style.display = "none";

        let selectedInterests = JSON.parse(sessionStorage.getItem('selectedInterests'));
        let checkboxes = document.querySelectorAll('#interestModal input[type="checkbox"]');

        sessionStorage.setItem('selectedInterests', JSON.stringify(selectedInterests));
        checkboxes.forEach(function(checkbox) {
            if (selectedInterests.includes(checkbox.value)) {
                checkbox.checked = true;
            } else {
                checkbox.checked = false;
            }
        });
    }
    function selectInterest(interest) {
        window.preventDefault();
        const interestOption = document.querySelector(`.interest-option[data-interest="${interest}"]`);
        interestOption.classList.toggle("selected");
    }

    function saveInterests() {
        showInterestedChecked();

        let checkboxes = document.querySelectorAll('#interestModal input[type="checkbox"]');
        let isChecked = false;
        for (let i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked) {
                isChecked = true;
                break;
            }
        }
        if (!isChecked) {
            swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Please select at least one interest',
            });
            return;
        }
        let selectedInterests = [];
        for (let i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked) {
                selectedInterests.push(checkboxes[i].value);
            }
        }
        sessionStorage.setItem('selectedInterests', JSON.stringify(selectedInterests));

        hideInterests();
    }

    function showInterestedChecked() {
        let checkboxes = document.querySelectorAll('#interestModal input[type="checkbox"]');
// Lặp qua từng checkbox và lưu giá trị đã chọn vào một mảng
        let selectedInterests = [];
        checkboxes.forEach(function(checkbox) {
            if (checkbox.checked) {
                selectedInterests.push(checkbox.value);
            }
        });
// Lưu mảng các giá trị đã chọn vào session storage
        sessionStorage.setItem('selectedInterests', JSON.stringify(selectedInterests));
// Tạo các phần tử HTML để hiển thị các giá trị đã chọn
        const showInterestsDiv = document.querySelector(".showInterests");
        showInterestsDiv.innerHTML = "";
        for (const interest of selectedInterests) {
            const interestElement = document.createElement("span");
            interestElement.textContent = interest;
            interestElement.classList.add("blabla", "custom-css-class")
            const selectedShowOptions = document.getElementsByClassName('blabla');
            const closeButton = document.createElement("i");
            closeButton.classList.add("fas", "fa-times");
            closeButton.style.color = "red";
            closeButton.addEventListener("click", function () {
                this.parentNode.parentNode.removeChild(this.parentNode);
                // Xóa giá trị đã chọn khỏi mảng selectedInterests
                let index = selectedInterests.indexOf(interest);
                if (index !== -1) {
                    selectedInterests.splice(index, 1);
                }
                // Cập nhật lại session storage
                sessionStorage.setItem('selectedInterests', JSON.stringify(selectedInterests));
                // Cập nhật lại các checkbox trong modal
                checkboxes.forEach(function(checkbox) {
                    if (selectedInterests.includes(checkbox.value)) {
                        checkbox.checked = true;
                    } else {
                        checkbox.checked = false;
                    }
                });
            });
            interestElement.appendChild(closeButton);
            showInterestsDiv.appendChild(interestElement);
        }
    }
    function disPlayImagelocalStorage() {
        const savedImages = localStorage.getItem('savedImages');
        if (savedImages) {
            const imageUrls = JSON.parse(savedImages);
            for (let i = 0; i < imageUrls.length; i++) {
                const imageUrl = imageUrls[i];
                const imgElement = document.getElementById(`preview-image-${i + 7}`);
                imgElement.src = imageUrl;
            }
        }
    }
    disPlayImagelocalStorage();
</script>
</html>

